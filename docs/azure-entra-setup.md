# Azure Entra設定ガイド

## 概要

ユーザー設定機能でAzure Entraからユーザー一覧を取得するために、Azure Entraアプリの設定が必要です。

## 必要な権限

Azure Entraアプリに以下のMicrosoft Graph API権限を付与してください：

### アプリケーション権限（推奨）
- `User.Read.All` - すべてのユーザーの基本プロファイルを読み取り
- `Directory.Read.All` - ディレクトリデータを読み取り

### 委任された権限（代替）
- `User.Read.All` - すべてのユーザーの基本プロファイルを読み取り
- `Directory.Read.All` - ディレクトリデータを読み取り

## 設定手順

### 1. Azure Entraアプリの作成

1. [Azure Portal](https://portal.azure.com)にアクセス
2. **Azure Active Directory** → **アプリの登録** → **新規登録**
3. アプリ名を入力（例：`MJC User Management`）
4. **サポートされているアカウントの種類**を選択
5. **リダイレクトURI**は設定不要（このアプリはWeb APIとして使用）

### 2. クライアントシークレットの作成

1. 作成したアプリを選択
2. **証明書とシークレット** → **新しいクライアントシークレット**
3. 説明を入力し、有効期限を選択
4. **値**をコピーして保存（後で環境変数に設定）

### 3. API権限の設定

1. **APIのアクセス許可** → **アクセス許可の追加**
2. **Microsoft Graph**を選択
3. **アプリケーション権限**を選択
4. 以下の権限を追加：
   - `User.Read.All`
   - `Directory.Read.All`
5. **管理者の同意を与える**をクリック

### 4. 環境変数の設定

以下の環境変数を設定してください：

```env
# Azure Entra設定
AZURE_AD_CLIENT_ID=your-app-client-id
AZURE_AD_CLIENT_SECRET=your-client-secret
AZURE_AD_TENANT_ID=your-tenant-id
```

### 5. 設定値の取得方法

#### クライアントID
- アプリの登録 → **概要** → **アプリケーション（クライアント）ID**

#### テナントID
- アプリの登録 → **概要** → **ディレクトリ（テナント）ID**

#### クライアントシークレット
- アプリの登録 → **証明書とシークレット** → 作成したシークレットの**値**

## トラブルシューティング

### 権限エラーが発生する場合
1. 管理者の同意が正しく与えられているか確認
2. アプリケーション権限が正しく設定されているか確認
3. クライアントシークレットが有効期限内か確認

### 認証エラーが発生する場合
1. 環境変数が正しく設定されているか確認
2. テナントIDが正しいか確認
3. クライアントIDとシークレットが正しいか確認

## セキュリティに関する注意事項

- クライアントシークレットは機密情報です。環境変数として安全に管理してください
- 本番環境では、Azure Key Vaultなどの安全な方法でシークレットを管理することを推奨します
- 必要最小限の権限のみを付与してください
